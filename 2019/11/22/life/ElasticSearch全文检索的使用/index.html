
<!DOCTYPE html>
<html lang="en">
    <!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  
    <link rel="icon" href="/img/favicon.png">
  
  
      <meta name="author" content="Fueen">
  
  
  
      <meta name="description" content="ä»–äººå³åœ°ç‹±">
  
  
  
    <link rel="alternate" href="/atom.xml " title="å…³å±±éš¾è¶Š" type="application/atom+xml">
  

  

  <title>ElasticSearchå…¨æ–‡æœç´¢çš„ä½¿ç”¨ | å…³å±±éš¾è¶Š</title>

  

  

  

  <link rel="stylesheet" href="/css/style.css" >
  <link rel="stylesheet" href="/css/partial/dark.css" >

  
  
  

  
    
      <link rel="stylesheet" href="/css/partial/highlight/atom-one-light.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/a2396837/CDN@latest/css/iconfont.css">
    
  

  
    <script src="/js/todark.js"></script>
    
<meta name="generator" content="Hexo 7.1.1"></head>
</html>
    
<div class="nav index" style="height: 60px;">
    <div class="title animated fadeInDown">
        <div class="layui-container">
            <div class="nav-list">
                
                <ul class="layui-nav" lay-filter="">
                    
                        
                        
                        
                        
                    <li class="layui-nav-item">
                        <a href="/ ">
                            <i class=" ä¸»é¡µ" style="color:;"></i>
                            <span class="layui-nav-item-name">ä¸»é¡µ</span>
                        </a>
                    </li>
                    
                        
                        
                        
                        
                    <li class="layui-nav-item">
                        <a href="/categories/ç”Ÿæ´»/ ">
                            <i class=" ç”Ÿæ´»" style="color:;"></i>
                            <span class="layui-nav-item-name">ç”Ÿæ´»</span>
                        </a>
                    </li>
                    
                        
                        
                        
                        
                    <li class="layui-nav-item">
                        <a href="/categories/æŠ€æœ¯/ ">
                            <i class=" æŠ€æœ¯" style="color:;"></i>
                            <span class="layui-nav-item-name">æŠ€æœ¯</span>
                        </a>
                    </li>
                    
                        
                        
                        
                        
                    <li class="layui-nav-item">
                        <a href="/about/ ">
                            <i class=" å…³äº" style="color:;"></i>
                            <span class="layui-nav-item-name">å…³äº</span>
                        </a>
                    </li>
                    
                    
                        <li class="layui-nav-item" id="btn-toggle-dark">ğŸŒ™</li>
                    
                    <span class="layui-nav-bar" style="left: 342px; top: 78px; width: 0px; opacity: 0;"></span>
                </ul>
            </div>
        </div>
    </div>
</div>
    
<header class="header">
        
            <div class="logo">
                    <a href="/"><img src="https://my-pic-1303449483.cos.ap-guangzhou.myqcloud.com/%E9%A3%9E%E4%B9%A620230227-111023.jpg" onerror=this.onerror=null,this.src="/img/loading.gif"></a>
            </div>
         
    </div>
     

            <div class="motto">
                <span>è°æ‚²å¤±è·¯ä¹‹äºº</span>
            </div>
    
     
</header>

    
<article id="post">
  <div class="post-title">ElasticSearchå…¨æ–‡æœç´¢çš„ä½¿ç”¨</div>
  
<div class="post-meta">
    
    
      <div class="post-meta-item date">
        <span title="Created 2019.11.22"><i class="far fa-calendar-alt"></i> 2019.11.22</span>
      </div>
      <div class="post-meta-item updated">
        <span title="Updated 2023.03.30"><i class="far fa-calendar-check"></i> 2023.03.30</span>
      </div>
     
    
      <div class="post-meta-item categories">
        
          <i class="fas fa-inbox article-meta__icon"></i> <a href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
        
      </div>
     
    
     <div class="post-meta-item wordcount">
        
          <i class="fas fa-pencil-alt"></i> <span class="post-count">2.9k words</span>
           
        
          <i class="far fa-clock"></i> <span class="post-count">13 min</span>
                               
      </div>
     
</div>


  
  <div class="content">
        <div><h1 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h1><p>[TOC]</p>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>ESæ˜¯Luceneçš„ä¸€ä¸ªå°è£…å·¥å…·ï¼Œè§£å†³äº†Luceneé…ç½®éº»çƒ¦ï¼Œä¸æ”¯æŒåˆ†å¸ƒå¼çš„ç¼ºç‚¹</p>
<p>ESä¹Ÿä½¿ç”¨Javaå¼€å‘å¹¶ä½¿ç”¨Luceneä½œä¸ºå…¶æ ¸å¿ƒæ¥å®ç°æ‰€æœ‰ç´¢å¼•å’Œæœç´¢çš„åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒçš„ç›®çš„æ˜¯é€šè¿‡ç®€å•çš„ RESTful APIæ¥éšè—Luceneçš„å¤æ‚æ€§ï¼Œä»è€Œè®©å…¨æ–‡æœç´¢å˜å¾—ç®€å•</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å®˜æ–¹ä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://www.elastic.co/downloads/elasticsearch">https://www.elastic.co/downloads/elasticsearch</a></p>
<p>ç„¶åè§£å‹ï¼Œè¿è¡Œbinè·¯å¾„ä¸‹çš„elasticsearch.batæ–‡ä»¶</p>
<span id="more"></span>

<p><img src= "/img/loading.gif" data-src="https://s2.ax1x.com/2019/11/20/MfyQeS.png" alt="1574244745968"></p>
<p><img src= "/img/loading.gif" data-src="https://s2.ax1x.com/2019/11/20/Mfyldg.png" alt="1574244783437"></p>
<p>è¿™æ ·å°±æˆåŠŸè¿è¡Œäº†ï¼Œç„¶ååœ¨æµè§ˆå™¨è¾“å…¥localhost:9200</p>
<p><img src= "/img/loading.gif" data-src="https://s2.ax1x.com/2019/11/20/MfyYzq.png" alt="1574244817786"></p>
<p>å‡ºç°è¿™ä¸ªç•Œé¢å°±ä»£è¡¨æˆåŠŸå¯åŠ¨</p>
<h3 id="è¾…åŠ©å·¥å…·Kibana5"><a href="#è¾…åŠ©å·¥å…·Kibana5" class="headerlink" title="è¾…åŠ©å·¥å…·Kibana5"></a>è¾…åŠ©å·¥å…·Kibana5</h3><p>åœ¨ä½¿ç”¨MySqlçš„æ—¶å€™ï¼Œå¯ä»¥ç”¨Navcationæ¥è¿›è¡Œå¯è§†åŒ–ç®¡ç†ï¼ŒKibana5å°±æ˜¯å¯ä»¥å¯¹ElasticSearchè¿›è¡Œå¯è§†åŒ–ç®¡ç†çš„ä¸€æ¬¾å·¥å…·</p>
<p>å®˜æ–¹ä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://www.elastic.co/downloads/kibana">https://www.elastic.co/downloads/kibana</a></p>
<p>è§£å‹ç„¶åä¿®æ”¹config&#x2F;kibana.ymlï¼Œè®¾ç½®elasticsearch.urlçš„å€¼ä¸ºå·²å¯åŠ¨çš„ESåœ°å€å€¼(ä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼Œé»˜è®¤å°±æ˜¯å¯¹çš„)</p>
<p>å¯åŠ¨Kibana5 : bin\kibana.bat</p>
<p>é»˜è®¤è®¿é—®åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://localhost:5601/">http://localhost:5601</a></p>
<p><img src= "/img/loading.gif" data-src="https://s2.ax1x.com/2019/11/20/MfyXm8.png"></p>
<p>æˆåŠŸè®¿é—®</p>
<h3 id="å¢åˆ æ”¹æŸ¥æ“ä½œ"><a href="#å¢åˆ æ”¹æŸ¥æ“ä½œ" class="headerlink" title="å¢åˆ æ”¹æŸ¥æ“ä½œ"></a>å¢åˆ æ”¹æŸ¥æ“ä½œ</h3><p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼ŒESæ˜¯å®Œå…¨éµä»äº†Restfulé£æ ¼çš„ï¼Œå…³äºRestfulé£æ ¼ï¼Œéšä¾¿ä¸€æœä¸€å¤§å †æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†</p>
<p>åœ¨ESä¸­å­˜å‚¨æ•°æ®çš„è¡Œä¸ºå°±å«åšç´¢å¼•(indexing)ï¼Œæ–‡æ¡£å½’å±äºä¸€ç§ç±»å‹(type),è€Œè¿™äº›ç±»å‹å­˜åœ¨äºç´¢å¼•(index)ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„å¯¹æ¯”ä¼ ç»Ÿæ•°æ®åº“å’ŒESçš„å¯¹åº”å…³ç³»ï¼š</p>
<p>å…³ç³»æ•°æ®åº“ï¼ˆMYSQLï¼‰ -&gt; æ•°æ®åº“DB-&gt; è¡¨TABLE-&gt; è¡ŒROW-&gt; åˆ—Column</p>
<p>ESçš„åŸºç¡€è¯­æ³•</p>
<ul>
<li>å¢åŠ :PUT PUT {index}&#x2F;{type}&#x2F;{id}</li>
<li>ä¿®æ”¹ï¼šåŒPUT {index}&#x2F;{type}&#x2F;{id}</li>
<li>åˆ é™¤ï¼šDELETE {index}&#x2F;{type}&#x2F;{id}</li>
<li>æŸ¥è¯¢ï¼šGET {index}&#x2F;{type}&#x2F;{id}</li>
</ul>
<p>ä¸‹é¢é€šè¿‡å‡ ä¸ªDemoæ¥è¿›è¡Œæ¼”ç¤º</p>
<p><img src= "/img/loading.gif" data-src="https://s2.ax1x.com/2019/11/20/MfRP5F.png"></p>
<h3 id="IKåˆ†è¯å™¨"><a href="#IKåˆ†è¯å™¨" class="headerlink" title="IKåˆ†è¯å™¨"></a>IKåˆ†è¯å™¨</h3><p>ESé»˜è®¤å¯¹è‹±æ–‡æ–‡æœ¬çš„åˆ†è¯å™¨æ”¯æŒè¾ƒå¥½ï¼Œä½†å’Œluceneä¸€æ ·ï¼Œå¦‚æœéœ€è¦å¯¹ä¸­æ–‡è¿›è¡Œå…¨æ–‡æ£€ç´¢ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ä¸­æ–‡åˆ†è¯å™¨ï¼ŒåŒluceneä¸€æ ·ï¼Œåœ¨ä½¿ç”¨ä¸­æ–‡å…¨æ–‡æ£€ç´¢å‰ï¼Œéœ€è¦é›†æˆIKåˆ†è¯å™¨</p>
<p>GitHubä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
<p>è§£å‹ï¼Œå¹¶å°†å…¶å†…å®¹æ”¾ç½®äºESæ ¹ç›®å½•&#x2F;plugins&#x2F;ik</p>
<p>ç„¶åé‡å¯ES</p>
<p>æµ‹è¯•åˆ†è¯</p>
<p><img src= "/img/loading.gif" data-src="https://s2.ax1x.com/2019/11/20/MfhvJU.png"></p>
<p><strong>æ³¨æ„ï¼šIKåˆ†è¯å™¨æœ‰ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ik_smartåˆ†è¯å™¨å’Œik_max_wordåˆ†è¯å™¨ã€‚</strong></p>
<p><strong>ik_smart: ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¸­åäººæ°‘å…±å’Œå›½å›½æ­Œâ€æ‹†åˆ†ä¸ºâ€œä¸­åäººæ°‘å…±å’Œå›½,å›½æ­Œâ€ã€‚</strong></p>
<p><strong>ik_max_word:ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¸­åäººæ°‘å…±å’Œå›½å›½æ­Œâ€æ‹†åˆ†ä¸ºâ€œä¸­åäººæ°‘å…±å’Œå›½,ä¸­åäººæ°‘,ä¸­å,åäºº,äººæ°‘å…±å’Œå›½,äººæ°‘,äºº,æ°‘,å…±å’Œå›½,å…±å’Œ,å’Œ,å›½å›½,å›½æ­Œâ€ï¼Œä¼šç©·å°½å„ç§å¯èƒ½çš„ç»„åˆ</strong></p>
<h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><p>ESç´¢å¼•çš„å¢åˆ æ”¹æŸ¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºç´¢å¼•åº“</span><br><span class="line"></span><br><span class="line">PUT imp</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 5,</span><br><span class="line">    &quot;number_of_replicas&quot;: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"># æŸ¥è¯¢ç´¢å¼•åº“</span><br><span class="line"></span><br><span class="line">GET _cat/indices</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æŒ‡å®šç´¢å¼•åº“</span><br><span class="line">GET _cat/indices/imp</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹ç´¢å¼•åº“</span><br><span class="line"></span><br><span class="line"># åˆ é™¤ç´¢å¼•åº“</span><br><span class="line">DELETE imp</span><br></pre></td></tr></table></figure>

<h2 id="DSLæŸ¥è¯¢"><a href="#DSLæŸ¥è¯¢" class="headerlink" title="DSLæŸ¥è¯¢"></a>DSLæŸ¥è¯¢</h2><p>DSLè¿‡æ»¤è¯­å¥å’ŒDSLæŸ¥è¯¢è¯­å¥éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬çš„ä½¿ç”¨ç›®çš„å´ä¸åŒï¼šDSLè¿‡æ»¤æŸ¥è¯¢æ–‡æ¡£çš„æ–¹å¼æ›´åƒæ˜¯å¯¹äºæˆ‘çš„æ¡ä»¶â€æœ‰â€æˆ–è€…â€æ²¡æœ‰â€ï¼ˆç­‰äº ï¼›ä¸ç­‰äºï¼‰ï¼Œè€ŒDSLæŸ¥è¯¢è¯­å¥åˆ™åƒæ˜¯â€æœ‰å¤šåƒâ€(æ¨¡ç³ŠæŸ¥è¯¢)</p>
<p>DSLè¿‡æ»¤å’ŒDSLæŸ¥è¯¢åœ¨æ€§èƒ½ä¸Šçš„åŒºåˆ«ï¼š</p>
<ul>
<li>è¿‡æ»¤ç»“æœå¯ä»¥ç¼“å­˜å¹¶åº”ç”¨åˆ°åç»­è¯·æ±‚ã€‚-&gt;  ç²¾ç¡®è¿‡æ»¤åçš„ç»“æœæ‹¿å»æ¨¡ç³ŠæŸ¥è¯¢æ€§èƒ½é«˜</li>
<li>æŸ¥è¯¢è¯­å¥åŒæ—¶åŒ¹é…æ–‡æ¡£ï¼Œè®¡ç®—ç›¸å…³æ€§ï¼Œæ‰€ä»¥æ›´è€—æ—¶ï¼Œä¸”ä¸ç¼“å­˜ã€‚</li>
<li>è¿‡æ»¤è¯­å¥å¯æœ‰æ•ˆåœ°é…åˆæŸ¥è¯¢è¯­å¥å®Œæˆæ–‡æ¡£è¿‡æ»¤</li>
</ul>
<p>æ¡ˆä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#DSLæŸ¥è¯¢</span><br><span class="line">GET fueen/person/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;speak&quot;: &quot;é«˜çº§åŠ¨ç‰©&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæµ‹è¯•æ•°æ®</span><br><span class="line">PUT fueen/user/5</span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:5,</span><br><span class="line">  &quot;sex&quot;:&quot;SAUMAG Note10 Pro&quot;,</span><br><span class="line">  &quot;ceagtor&quot;:&quot;æ‰‹æœº&quot;,</span><br><span class="line">  &quot;money&quot;:8000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET fueen/user/_search?_source</span><br><span class="line"></span><br><span class="line"># DSLè¿‡æ»¤</span><br><span class="line"></span><br><span class="line">GET fueen/user/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;ceagtor&quot;: &quot;æ‰‹æœº&quot;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;money&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 6000,</span><br><span class="line">            &quot;lte&quot;: 8000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0, </span><br><span class="line">  &quot;size&quot;: 10,</span><br><span class="line">  &quot;_source&quot;: [&quot;sex&quot;,&quot;ceagtor&quot;,&quot;money&quot;],</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;money&quot;: &quot;desc&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡æ¡£æ˜ å°„"><a href="#æ–‡æ¡£æ˜ å°„" class="headerlink" title="æ–‡æ¡£æ˜ å°„"></a>æ–‡æ¡£æ˜ å°„</h2><p>ESçš„æ–‡æ¡£æ˜ å°„(mapping)æœºåˆ¶ç”¨äºè¿›è¡Œå­—æ®µç±»å‹ç¡®è®¤ï¼Œå°†æ¯ä¸ªå­—æ®µåŒ¹é…ä¸ºä¸€ç§ç¡®å®šçš„æ•°æ®ç±»å‹</p>
<p>å°±æ˜¯è§„å®šäº†æ¯ä¸ªè¾“å…¥å­—æ®µå€¼çš„æ•°æ®ç±»å‹</p>
<p>æ¡ˆä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"># æ˜ å°„</span><br><span class="line">PUT imp/life/_mapping</span><br><span class="line">&#123;</span><br><span class="line">  &quot;life&quot;:&#123;</span><br><span class="line">    &quot;properties&quot;:&#123;</span><br><span class="line">      &quot;id&quot;:&#123;</span><br><span class="line">        &quot;type&quot;:&quot;long&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;name&quot;:&#123;</span><br><span class="line">        &quot;type&quot;:&quot;text&quot;,</span><br><span class="line">        &quot;analyzer&quot;:&quot;ik_smart&quot;,</span><br><span class="line">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ–‡æ¡£æ˜ å°„</span><br><span class="line">GET imp/_mapping/life</span><br><span class="line"></span><br><span class="line"># åˆ é™¤æ˜ å°„</span><br><span class="line">DELETE imp</span><br><span class="line"></span><br><span class="line"># åŠ¨æ€æ¨¡æ¿</span><br><span class="line">PUT _template/kof_template  </span><br><span class="line">&#123;</span><br><span class="line">  &quot;template&quot;:   &quot;*&quot;,  </span><br><span class="line">  &quot;settings&quot;: &#123; &quot;number_of_shards&quot;: 1 &#125;, </span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;_default_&quot;: &#123;</span><br><span class="line">      &quot;_all&quot;: &#123; </span><br><span class="line">        &quot;enabled&quot;: false </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;dynamic_templates&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;string_as_text&quot;: &#123; </span><br><span class="line">            &quot;match_mapping_type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;match&quot;:   &quot;*_text&quot;, </span><br><span class="line">            &quot;mapping&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">              &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">              &quot;search_analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">              &quot;fields&quot;: &#123;</span><br><span class="line">                &quot;raw&quot;: &#123;</span><br><span class="line">                  &quot;type&quot;:  &quot;keyword&quot;,</span><br><span class="line">                  &quot;ignore_above&quot;: 256</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;string_as_keyword&quot;: &#123; </span><br><span class="line">            &quot;match_mapping_type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;mapping&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">             &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><p>ä¸ºä»€ä¹ˆéœ€è¦ESé›†ç¾¤</p>
<p>å’ŒRedisä¸€æ ·ï¼Œé›†ç¾¤èƒ½å¤Ÿåšå¾ˆå¤šäº‹æƒ…</p>
<ul>
<li>å•èŠ‚ç‚¹æ•…éšœ</li>
<li>æ”¯æŒé«˜å¹¶å‘</li>
<li>æµ·é‡æ•°æ®å­˜å‚¨</li>
</ul>
<p><strong>ESçš„é›†ç¾¤èŠ‚ç‚¹</strong></p>
<p><strong>ä¸»èŠ‚ç‚¹</strong></p>
<p>node.master&#x3D;true,ä»£è¡¨è¯¥èŠ‚ç‚¹æœ‰æˆä¸ºä¸»èµ„æ ¼ï¼Œä¸»èŠ‚ç‚¹çš„ä¸»è¦èŒè´£æ˜¯å’Œé›†ç¾¤æ“ä½œç›¸å…³çš„å†…å®¹ï¼Œå¦‚<strong>åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ï¼Œè·Ÿè¸ªå“ªäº›èŠ‚ç‚¹æ˜¯ç¾¤é›†çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶å†³å®šå“ªäº›åˆ†ç‰‡åˆ†é…ç»™ç›¸å…³çš„èŠ‚ç‚¹</strong>ã€‚ä¸€èˆ¬ä¼šæŠŠä¸»èŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹åˆ†å¼€ï¼Œnode.master&#x3D;true , node.data&#x3D;false</p>
<p><strong>æ•°æ®èŠ‚ç‚¹</strong></p>
<p>node.data&#x3D;true,æ•°æ®èŠ‚ç‚¹ä¸»è¦æ˜¯å­˜å‚¨ç´¢å¼•æ•°æ®çš„èŠ‚ç‚¹ï¼Œ<strong>ä¸»è¦å¯¹æ–‡æ¡£è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œèšåˆæ“ä½œ</strong>ç­‰,æ•°æ®èŠ‚ç‚¹å¯¹CPU,IO,å†…å­˜è¦æ±‚è¾ƒé«˜ï¼Œä¼˜åŒ–èŠ‚ç‚¹çš„æ—¶å€™éœ€è¦åšçŠ¶æ€ç›‘æ§ï¼Œèµ„æºä¸å¤Ÿæ—¶è¦åšèŠ‚ç‚¹æ‰©å……ã€‚é…ç½®ï¼šmode.master&#x3D;false,mode.data&#x3D;true</p>
<p><strong>è´Ÿè½½å‡è¡¡èŠ‚ç‚¹</strong></p>
<p>å½“ä¸»èŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹é…ç½®éƒ½è®¾ç½®ä¸ºfalseçš„æ—¶å€™ï¼Œ<strong>è¯¥èŠ‚ç‚¹åªèƒ½å¤„ç†è·¯ç”±è¯·æ±‚ï¼Œå¤„ç†æœç´¢ï¼Œåˆ†å‘ç´¢å¼•æ“ä½œ</strong>ç­‰ï¼Œä»æœ¬è´¨ä¸Šæ¥è¯´è¯¥å®¢æˆ·èŠ‚ç‚¹è¡¨ç°ä¸ºæ™ºèƒ½è´Ÿè½½å¹³è¡¡å™¨ã€‚é…ç½®ï¼šmode.master&#x3D;false,mode.data&#x3D;false</p>
<h3 id="æ¨¡æ‹Ÿæ­å»ºé›†ç¾¤"><a href="#æ¨¡æ‹Ÿæ­å»ºé›†ç¾¤" class="headerlink" title="æ¨¡æ‹Ÿæ­å»ºé›†ç¾¤"></a>æ¨¡æ‹Ÿæ­å»ºé›†ç¾¤</h3><p>å‡†å¤‡ä¸‰ä¸ªESæœåŠ¡</p>
<p>å¯ä»¥æ¨¡æ‹Ÿå‡ºä¸‰ä¸ªä¸åŒçš„æ–‡ä»¶ï¼Œä¿®æ”¹ä¸åŒçš„ç«¯å£</p>
<p>é…ç½®è¯´æ˜</p>
<ul>
<li>Node1-é…ç½®</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ç»Ÿä¸€çš„é›†ç¾¤å</span><br><span class="line">cluster.name: my-ealsticsearch</span><br><span class="line"># å½“å‰èŠ‚ç‚¹å</span><br><span class="line">node.name: node-1</span><br><span class="line"># å¯¹å¤–æš´éœ²ç«¯å£ä½¿å¤–ç½‘è®¿é—®</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"># å¯¹å¤–æš´éœ²ç«¯å£</span><br><span class="line">http.port: 9201</span><br><span class="line">#é›†ç¾¤é—´é€šè®¯ç«¯å£å·</span><br><span class="line">transport.tcp.port: 9301</span><br><span class="line">#é›†ç¾¤çš„ipé›†åˆï¼Œå¯æŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä¸º9300</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;,&quot;127.0.0.1:9303&quot;]</span><br></pre></td></tr></table></figure>

<ul>
<li>Node2-é…ç½®</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ç»Ÿä¸€çš„é›†ç¾¤å</span><br><span class="line">cluster.name: my-ealsticsearch</span><br><span class="line"># å½“å‰èŠ‚ç‚¹å</span><br><span class="line">node.name: node-2</span><br><span class="line"># å¯¹å¤–æš´éœ²ç«¯å£ä½¿å¤–ç½‘è®¿é—®</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"># å¯¹å¤–æš´éœ²ç«¯å£</span><br><span class="line">http.port: 9202</span><br><span class="line">#é›†ç¾¤é—´é€šè®¯ç«¯å£å·</span><br><span class="line">transport.tcp.port: 9302</span><br><span class="line">#é›†ç¾¤çš„ipé›†åˆï¼Œå¯æŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä¸º9300</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;,&quot;127.0.0.1:9303&quot;]</span><br></pre></td></tr></table></figure>

<ul>
<li>Node3-é…ç½®</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ç»Ÿä¸€çš„é›†ç¾¤å</span><br><span class="line">cluster.name: my-ealsticsearch</span><br><span class="line"># å½“å‰èŠ‚ç‚¹å</span><br><span class="line">node.name: node-3</span><br><span class="line"># å¯¹å¤–æš´éœ²ç«¯å£ä½¿å¤–ç½‘è®¿é—®</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"># å¯¹å¤–æš´éœ²ç«¯å£</span><br><span class="line">http.port: 9203</span><br><span class="line">#é›†ç¾¤é—´é€šè®¯ç«¯å£å·</span><br><span class="line">transport.tcp.port: 9303</span><br><span class="line">#é›†ç¾¤çš„ipé›†åˆï¼Œå¯æŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä¸º9300</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;,&quot;127.0.0.1:9303&quot;]</span><br></pre></td></tr></table></figure>

<p>åˆ†åˆ«å¯åŠ¨ä¸‰ä¸ªESèŠ‚ç‚¹ ï¼Œ è®¿é—®ï¼š<a target="_blank" rel="noopener" href="http://127.0.0.1:9201/">http://127.0.0.1:9201/</a></p>
<p><img src= "/img/loading.gif" data-src="https://s2.ax1x.com/2019/11/22/MTMVSg.png"></p>
<p>ç„¶åå†é€šè¿‡Kiban5å»è®¿é—®ï¼Œä¿®æ”¹é»˜è®¤é…ç½®è·¯å¾„ä¸ºï¼šelasticsearch.url: â€œ<a target="_blank" rel="noopener" href="http://localhost:9201/">http://localhost:9201</a>â€œ</p>
<p><img src= "/img/loading.gif" data-src="https://s2.ax1x.com/2019/11/22/M7acsx.png"></p>
<p>è®¿é—®æˆåŠŸ</p>
<h2 id="Javaæ“ä½œES"><a href="#Javaæ“ä½œES" class="headerlink" title="Javaæ“ä½œES"></a>Javaæ“ä½œES</h2><p>åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®ï¼Œåœ¨pom.xmlä¸­åŠ å…¥</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>transport<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ªè¿æ¥ESçš„å·¥å…·ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ifueen.es;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.TransportClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.transport.InetSocketTransportAddress;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.transport.client.PreBuiltTransportClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ESé›†ç¾¤çš„å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ESClientUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TransportClient <span class="title function_">getClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Settings</span> <span class="variable">settings</span> <span class="operator">=</span> Settings.builder()</span><br><span class="line">        .put(<span class="string">&quot;cluster.name&quot;</span>,<span class="string">&quot;my-ealsticsearch&quot;</span>)</span><br><span class="line">        .put(<span class="string">&quot;client.transport.sniff&quot;</span>, <span class="literal">true</span>).build();</span><br><span class="line">        </span><br><span class="line">        <span class="type">TransportClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client = <span class="keyword">new</span> <span class="title class_">PreBuiltTransportClient</span>(settings)</span><br><span class="line">                    .addTransportAddress(</span><br><span class="line">                    		<span class="keyword">new</span> <span class="title class_">InetSocketTransportAddress</span>(InetAddress.getByName(<span class="string">&quot;127.0.0.1&quot;</span>), <span class="number">9302</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¼€å§‹æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ifueen.es;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkItemResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.TransportClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHits;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•é›†ç¾¤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestESCluster</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="type">TransportClient</span> <span class="variable">client</span> <span class="operator">=</span> ESClientUtil.getClient();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ æ–‡æ¡£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testadd</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºç´¢å¼•</span></span><br><span class="line">        <span class="type">IndexRequestBuilder</span> <span class="variable">index</span> <span class="operator">=</span> client.prepareIndex(<span class="string">&quot;fueen&quot;</span>, <span class="string">&quot;person&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        Map&lt;String,Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">        data.put(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        data.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;fueen&quot;</span>);</span><br><span class="line">        data.put(<span class="string">&quot;speak&quot;</span>,<span class="string">&quot;æˆ‘ä»¬ä¸èƒ½å¤±å»ä¿¡ä»°&quot;</span>);</span><br><span class="line">        <span class="comment">//æ·»åŠ </span></span><br><span class="line">        <span class="type">IndexResponse</span> <span class="variable">indexResponse</span> <span class="operator">=</span> index.setSource(data).get();</span><br><span class="line">        System.out.println(indexResponse);</span><br><span class="line">        client.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ–‡æ¡£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testquery</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">GetResponse</span> <span class="variable">getFields</span> <span class="operator">=</span> client.prepareGet(<span class="string">&quot;fueen&quot;</span>, <span class="string">&quot;person&quot;</span>, <span class="string">&quot;1&quot;</span>).get();</span><br><span class="line">        System.out.println(getFields.getSource());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testupdate</span><span class="params">()</span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;è¿™ä¸ªä¸–ç•Œä¼šå¥½å—&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;speak&quot;</span>,<span class="string">&quot;æå¿—&quot;</span>);</span><br><span class="line">        <span class="type">UpdateRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> client.prepareUpdate(<span class="string">&quot;fueen&quot;</span>, <span class="string">&quot;person&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="type">UpdateResponse</span> <span class="variable">updateResponse</span> <span class="operator">=</span> builder.setDoc(map).get();</span><br><span class="line">        System.out.println(updateResponse);</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æ–‡æ¡£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testdel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DeleteRequestBuilder</span> <span class="variable">del</span> <span class="operator">=</span> client.prepareDelete(<span class="string">&quot;fueen&quot;</span>, <span class="string">&quot;person&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="type">DeleteResponse</span> <span class="variable">deleteResponse</span> <span class="operator">=</span> del.get();</span><br><span class="line">        System.out.println(deleteResponse);</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ·»åŠ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testbulikadd</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">BulkRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> client.prepareBulk();</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;ä¼šæ²‰å¯‚å—&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;speak&quot;</span>,<span class="string">&quot;æˆ‘çš„é‡‘æ¡”&quot;</span>);</span><br><span class="line">        builder.add(client.prepareIndex(<span class="string">&quot;fueen&quot;</span>,<span class="string">&quot;person&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                .setSource(map));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; map1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map1.put(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        map1.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;ä¼šæ²‰å¯‚å—&quot;</span>);</span><br><span class="line">        map1.put(<span class="string">&quot;speak&quot;</span>,<span class="string">&quot;äººæ°‘ä¸éœ€è¦è‡ªç”±&quot;</span>);</span><br><span class="line">        builder.add(client.prepareIndex(<span class="string">&quot;fueen&quot;</span>,<span class="string">&quot;person&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">                .setSource(map1));</span><br><span class="line"></span><br><span class="line">        <span class="type">BulkResponse</span> <span class="variable">bulkItemResponses</span> <span class="operator">=</span> builder.get();</span><br><span class="line">        Iterator&lt;BulkItemResponse&gt; iterator = bulkItemResponses.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            <span class="type">BulkItemResponse</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            System.out.println(next.getResponse());</span><br><span class="line">        &#125;</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testbulikquery</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SearchRequestBuilder</span> <span class="variable">fueen</span> <span class="operator">=</span> client.prepareSearch(<span class="string">&quot;fueen&quot;</span>);</span><br><span class="line">        fueen.setTypes(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">        fueen.setFrom(<span class="number">0</span>);</span><br><span class="line">        fueen.setSize(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">        <span class="type">BoolQueryBuilder</span> <span class="variable">boolQueryBuilder</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">        List&lt;QueryBuilder&gt; must = boolQueryBuilder.must();</span><br><span class="line">        must.add(QueryBuilders.matchQuery(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;ä¼šæ²‰å¯‚å—&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> fueen.setQuery(boolQueryBuilder).get();</span><br><span class="line">        <span class="type">SearchHits</span> <span class="variable">hits</span> <span class="operator">=</span> searchResponse.getHits();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¡æ•°:&quot;</span>+hits.getTotalHits());</span><br><span class="line">        hits.forEach(h-&gt;&#123;</span><br><span class="line">            System.out.println(h);</span><br><span class="line">        &#125;);</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

</div>
        
          <div class="post-copyright">
                  <div class="copyright-item">
                      <span> Author: Fueen</span>
                  </div>
                  <div class="copyright-item">
                      <span> Link: <a href="https://ifueen.com/2019/11/22/life/ElasticSearch%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2%E7%9A%84%E4%BD%BF%E7%94%A8/">https://ifueen.com/2019/11/22/life/ElasticSearch%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2%E7%9A%84%E4%BD%BF%E7%94%A8/</a></span>
                  </div>
                  <div class="copyright-item">
                      <span> License: æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨è®¸å¯åè®® <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</span>
                  </div>
          </div>
        
  </div>

  <div class="share-reward">
    <div class="share">
        
<div class="social-share" data-sites="facebook,twitter,wechat,weibo,qq"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script>


      </div>
        <div class="reward">
          
        </div>
    </div>
    
    <div class="post_tags">
      
    </div>
    <div class="post-nav">
      
        <div class="post-nav-prev post-nav-item">
            <a href="/2020/02/07/life/%E8%AE%B0%E5%87%A0%E6%AC%A1Java%E9%9D%A2%E7%BB%8F/" >è®°å‡ æ¬¡Javaé¢ç»<i class="fa fa-chevron-left"></i></a>
        </div>
      
      
        <div class="post-nav-next post-nav-item">
            <a href="/2019/10/17/life/%E6%B0%B8%E8%BF%9C%E7%9A%84%E8%9D%B4%E8%9D%B6/" >æ°¸è¿œçš„è´è¶<i class="fa fa-chevron-right"></i></a>
        </div>
      
    </div>
      



  <div id="valine"></div>
  <script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script>
  <script>
        new Valine({
          el: '#valine',
          appId: "",
          appKey: "",
          avatar: "mm",
          lang: "",
          meta: 'nick,mail,link'.split(','),
          requiredFields: 'nick,mail'.split(','),
          placeholder: "è¯„è®ºè®°å¾—å¸¦ä¸Šé‚®ç®±,ä½ çš„ç•™è¨€æˆ‘ä¼šé©¬ä¸Šæ”¶åˆ°é‚®ç®±æé†’å“’",
          pageSize:'10',
          recordIP: 'false',
          serverURLs: "",
          emojiCDN: "",
          enableQQ: "true",
        });
  </script>
  

</article>

    
<a id="gotop" href="javascript:" title="è¿”å›é¡¶éƒ¨"><i class="fa fa-arrow-up"></i></a>
    






    
<div id="bottom-outer">
    <div id="bottom-inner">
        Â© 2019-2024 <i class="fa fa-heart" id="heart"></i> Fueen 
        <br>
        Powered by 
        <a target="_blank" rel="noopener" href="http://hexo.io">hexo</a>
        
          <div class="icp-info">
            
          <a href="" target="_blank"> </a>
        </div>
        
    </div>  
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/layui-src@2.5.5/dist/layui.min.js"></script>



  
    <script src="/js/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
  

 



  <script>
    window.lazyLoadOptions = {
      elements_selector: 'img',
      threshold: 0
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script>   
  


  <script>
    var images = $('img').not('.nav-logo img').not('.card img').not($('a>img')).not('.reward-content img')
    images.each(function (i, o) {
      var lazyloadSrc = $(o).attr('data-src') ? $(o).attr('data-src') : $(o).attr('src')
      $(o).wrap(`<a href="${lazyloadSrc}" data-fancybox="group" data-caption="${$(o).attr('alt')}" class="fancybox"></a>`)
    })
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script>
  <script>
        $().fancybox({
      selector: '[data-fancybox]',
      loop: true,
      transitionEffect: 'slide',
      protect: true,
      buttons: ['slideShow', 'fullScreen', 'thumbs', 'close']
    })
  </script>   
  










  <script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script>
  




  
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js"></script>
<script>
!function (e, t, a) {
  var initCopyCode = function(){
    var copyHtml = '';
    copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
    copyHtml += '  <i class="fa fa-clipboard"></i><span>å¤åˆ¶</span>';
    copyHtml += '</button>';
    $(".highlight .code pre").before(copyHtml);
    new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
  }
  initCopyCode();
}(window, document);
</script>  
  

<script>
  var btntop = $('#gotop');
  btntop.on('click', function (e) {
    e.preventDefault();
    $('html, body').animate({ scrollTop: 0 }, '300');
  });

  var $table = $('.content table').not($('figure.highlight > table'))
$table.each(function () {
  $(this).wrap('<div class="table-wrap"></div>')
})
</script>



</html>